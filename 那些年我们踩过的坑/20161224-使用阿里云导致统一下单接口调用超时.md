# 使用阿里云导致统一下单接口调用超时

> [时间：2016.12.24] [作者：JeffreySu] [关键字：阿里云,统一下单,支付,超时]

## 现象

调用统一下单接口（Senparc.Weixin.MP.AdvancedAPIs.TenPayV3.Unifiedorder()）的时候，
需要等待很长时间，尤其是一段时间后第一次调用特别慢，甚至出现超时的情况。

##解决方案

除了我们感官上发现速度有问题以外，也可以使用阿里云主机ping统一下单的域名（api.mch.weixin.qq.com），如果IP不是正确的官方服务器IP，则说明有问题。
官方文档提供给的IP为：182.254.44.159，也许是因为微信使用了CDN的缘故，我们实际测试发现目前正常速度的配置下，ping出来的IP在阿里云为：183.3.235.18，在西数为：101.226.90.149，在其他网络上ping出来的结果也会不一样，所以官方文档提供的IP似乎也不是最靠谱，建议开发者任然要结合感官的速度判断（通常超过5秒钟已经不太正常了）。
微信官方的解释是这是阿里云使用的BGP造成的（但是其他服务商的BGP就很少出现这个问题），无论如何，解决方法都是一样的：修改阿里云主机中外网网卡的DNS如下：

>首选DNS服务器：233.5.5.5

>备选DNS服务器：233.6.6.6

如果此方案无效，再试一下下面的配置：

>首选DNS服务器：10.202.72.116

>备选DNS服务器：10.202.72.118

或者换成腾讯的DNS：

>首选DNS服务器：119.29.29.29

>备选DNS服务器：不设置

如果还不行，请向阿里云提交工单，询问最新的DNS配置情况。